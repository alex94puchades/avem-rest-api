{"version":3,"sources":["bin/config.js"],"names":[],"mappings":"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","file":"bin/config.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport util from 'util';\n\nimport ask from 'ask-sync';\n\ntry {\n\tlet config = askConfigSettings();\n\tif (confirmConfigSettings(config) &&\n\t    saveConfigSettings(config)) {\n\t    \tconsole.log('Settings saved in config.js');\n\t} else {\n\t\tconsole.log('Settings not saved');\n\t}\n\tconsole.log();\n\tconsole.log('Done');\n} catch (e) {\n\tconsole.log('Fatal error: ' + e.message);\n}\n\nfunction askConfigSettings() {\n\treturn ask({\n\t\tdb: askDatabaseSettings,\n\t\tcors: askCorsSettings,\n\t\toauth2: askOAuth2Settings,\n\t\tlogging: askLoggingSettings,\n\t\tsecurity: askSecuritySettings,\n\t\tserver: askServerSettings,\n\t});\n}\n\nfunction showConfigSettings(config) {\n\tlet contents = util.inspect(config, { depth: null });\n\tconsole.log('Settings:');\n\tconsole.log(contents);\n}\n\nfunction confirmConfigSettings(config) {\n\tshowConfigSettings(config);\n\tconsole.log();\n\tlet index = ask.string('Is this correct?', {\n\t\tvalues: ['y','n'], default: 'y'\n\t})();\n\treturn index === 'y';\n}\n\nfunction saveConfigSettings(config) {\n\tif (fs.existsSync('config.js.old')) {\n\t\tif (!fs.existsSync('config.js')) {\n\t\t\tfs.renameSync('config.js', 'config.js.old');\n\t\t} else {\n\t\t\tconsole.log('\"config.js.old\" file exists. Remove it and run setup again');\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\tlet contents = '// Do not edit this file, changes will be overwritten\\n\\n';\n\tif (fs.existsSync('config.js.prepend'))\n\t\tcontents += fs.readFileSync('config.js.prepend') + '\\n\\n';\n\tlet object = util.inspect(config, { depth: null });\n\tcontents += 'module.exports = exports = ' + object + ';\\n';\n\tif (fs.existsSync('config.js.append'))\n\t\tcontents += '\\n\\n' + fs.readFileSync('config.js.append');\n\tif (fs.existsSync('config.js'))\n\t\tfs.renameSync('config.js', 'config.js.old');\n\tfs.writeFileSync('config.js', contents);\n\treturn true;\n}\n\nfunction askDatabaseSettings() {\n\tconsole.log('Database Settings');\n\tconsole.log('-----------------');\n\tlet settings = ask({\n\t\tmongo: askMongoDbParams,\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askCorsSettings() {\n\tconsole.log('CORS Settings');\n\tconsole.log('-------------');\n\tlet settings = ask({\n\t\torigin: ask.variant('Origin filter (js)', { default: '*' }),\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askOAuth2Settings() {\n\tconsole.log('OAuth2 Settings');\n\tconsole.log('---------------');\n\tlet settings = ask({\n\t\tclient: {\n\t\t\tsecret: {\n\t\t\t\tlength: ask.number('Client secret length', { default: 30 }),\n\t\t\t},\n\t\t},\n\t\ttoken: {\n\t\t\tlength: ask.number('Token length', { default: 30 }),\n\t\t\tresourceOwnerDuration: ask.number('Resource owner token duration (s)', { default: 24 * 60 * 60 }),\n\t\t\tremoveExpiredInterval: ask.number('Remove expired tokens interval (s)', { default: 2 * 60 * 60 }),\n\t\t},\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askLoggingSettings() {\n\tconsole.log('Logging Settings');\n\tconsole.log('----------------');\n\tlet settings = ask({\n\t\toutputPath: ask.string('Log file', { default: './errors.log' }),\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askSecuritySettings() {\n\tconsole.log('Security Settings');\n\tconsole.log('-----------------');\n\tlet settings = ask({\n\t\tpassword: {\n\t\t\tminLength: ask.number('Password min length', { default: 8 }),\n\t\t\tmaxLength: ask.number('Password max length', { default: 25 }),\n\t\t},\n\t\thash: {\n\t\t\tscrypt: {\n\t\t\t\tmaxtime: ask.number('Scrypt max time', { default: 0.1 }),\n\t\t\t\tmaxmem: ask.number('Scrypt max memory', { nullable: true }),\n\t\t\t\tmaxmemfrac: ask.number('Scrypt max memory factor', { nullable: true }),\n\t\t\t},\n\t\t},\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askServerSettings() {\n\tconsole.log('Server Settings');\n\tconsole.log('---------------');\n\tlet settings = ask({\n\t\tport: ask.number('Port', { default: 8080 }),\n\t});\n\tconsole.log();\n\treturn settings;\n}\n\nfunction askMongoDbParams() {\n\tlet data = ask({\n\t\thost: ask.string('Host'),\n\t\tport: ask.number('Port', { nullable: true }),\n\t\ttable: ask.string('Table name'),\n\t});\n\treturn {\n\t\turl: data.port === undefined\n\t\t       ? 'mongodb://' + data.host + '/' + data.table\n\t\t       : 'mongodb://' + data.host + ':' + data.port + '/' + data.table\n\t};\n}\n"],"sourceRoot":"/source/"}