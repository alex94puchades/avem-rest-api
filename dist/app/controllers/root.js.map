{"version":3,"sources":["app/controllers/root.js"],"names":[],"mappings":";;;;;;;;;;qBAAkB,OAAO;;;;uBACJ,SAAS;;yBACP,WAAW;;sBAEV,UAAU;;IAAtB,MAAM;;AAElB,IAAM,MAAM,GAAG,aALP,MAAM,GAKS,CAAC;;AAExB,MAAM,CAAC,GAAG,CAAC,GAAG,EACb,MAAM,CAAC,YAAY,CAAC,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC,EAClD,UAAC,GAAG,EAAE,GAAG,EAAK;AACb,KAAM,QAAQ,GAAG,eATX,QAAQ,CASgB,GAAG,CAAC,CAAC;AACnC,KAAI,GAAG,CAAC,IAAI,EAAE;AACb,qBAAM,QAAQ,CAAC;AACd,OAAI,EAAE,mBAAM,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC;AAC9B,UAAO,EAAE,iBAAC,IAAI,EAAK;AAClB,UAAM,CAAC,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IACjC;GACD,EAAE,UAAC,GAAG,EAAE,OAAO,EAAK;AACpB,OAAI,GAAG,EAAE,MAAM,GAAG,CAAC;AACnB,WAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC;AACtC,WAAQ,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,SAAS,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC;AAC3D,WAAQ,CAAC,KAAK,CAAC,cAAc,CAAC,GAAG,YAAY,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;AACpE,WAAQ,CAAC,IAAI,EAAE,CAAC;GAChB,CAAC,CAAC;EACH,MAAM;AACN,UAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,KAAK,CAAC;AACvC,UAAQ,CAAC,KAAK,CAAC,kBAAkB,CAAC,GAAG,eAAe,CAAC;AACrD,UAAQ,CAAC,IAAI,EAAE,CAAC;EAChB;CACD,CAAC,CAAC;;qBAEW,MAAM","file":"app/controllers/root.js","sourcesContent":["import async from 'async';\nimport {Router} from 'express';\nimport {Response} from 'jsonapify';\n\nimport * as common from './common';\n\nconst router = Router();\n\nrouter.get('/', \n\tcommon.authenticate(['token-bearer', 'anonymous']),\n\t(req, res) => {\n\t\tconst response = new Response(res);\n\t\tif (req.user) {\n\t\t\tasync.parallel({\n\t\t\t\tuser: async.constant(req.user),\n\t\t\t\tsession: (next) => {\n\t\t\t\t\tcommon.currentSession(req, next);\n\t\t\t\t},\n\t\t\t}, (err, results) => {\n\t\t\t\tif (err) throw err;\n\t\t\t\tresponse.meta['authenticated'] = true;\n\t\t\t\tresponse.links['this-user'] = '/users/' + results.user._id;\n\t\t\t\tresponse.links['this-session'] = '/sessions/' + results.session._id;\n\t\t\t\tresponse.send();\n\t\t\t});\n\t\t} else {\n\t\t\tresponse.meta['authenticated'] = false;\n\t\t\tresponse.links['oauth2-token-url'] = '/oauth2/token';\n\t\t\tresponse.send();\n\t\t}\n\t});\n\nexport default router;\n"],"sourceRoot":"/source/"}